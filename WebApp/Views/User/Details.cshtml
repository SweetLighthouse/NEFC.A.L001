@using System.Security.Claims
@using FA.Domain.Enumerations
@using WebApp.Controllers
@using WebApp.Services
@model FA.Application.Dtos.Users.UserDetailDto
@inject AuthorizerService authorizerService
@{
    ViewData["Title"] = "Details";
}

<!-- Page Header-->
<header class="masthead" style="background-image: url('assets/img/home-bg.jpg')">
    <div class="container position-relative px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="col-md-10 col-lg-8 col-xl-7">
                <div class="site-heading">
                    <h1>User details</h1>
                    @* <span class="subheading">A Blog Theme by Start Bootstrap</span> *@
                </div>
            </div>
        </div>
    </div>
</header>
<!-- Main Content-->
<div class="container px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
        <div class="col-md-10 col-lg-8 col-xl-7">

            <!-- Real Content -->
            <dl class="row">
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.CreatedAt)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.CreatedAt)
                </dd>

                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.Creator)
                </dt>
                <dd class="col-sm-10">
                    <a asp-controller="@nameof(UserController)[..^10]"
                    asp-action="@nameof(UserController.Details)"
                    asp-route-id="@Model.Creator.Id">
                        @Html.DisplayFor(model => model.Creator.Username)
                    </a>
                </dd>

                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.UpdatedAt)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.UpdatedAt)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.Username)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.Username)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.Role)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.Role)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.Email)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.Email)
                </dd>
                <dt class="col-sm-2">
                    @Html.DisplayNameFor(model => model.About)
                </dt>
                <dd class="col-sm-10">
                    @Html.DisplayFor(model => model.About)
                </dd>
            </dl>

            <div class="mb-2">
                @if (authorizerService.HasPermission(User.FindFirst(ClaimTypes.Role)?.Value, ModuleAction.UpdateUser))
                {
                    <a asp-controller="@nameof(UserController)[..^10]"
                    asp-action="@nameof(UserController.Edit)"
                    asp-route-id="@Model.Id"
                    class="btn btn-warning">
                        Edit
                    </a>

                    <a asp-controller="@nameof(UserController)[..^10]"
                    asp-action="@nameof(UserController.ChangePassword)"
                    asp-route-id="@Model.Id"
                    class="btn btn-warning">
                        Change password
                    </a>
                }

                @if (authorizerService.HasPermission(User.FindFirst(ClaimTypes.Role)?.Value, ModuleAction.DeleteUser))
                {
                    <a asp-controller="@nameof(UserController)[..^10]"
                       asp-action="@nameof(UserController.Delete)"
                       asp-route-id="@Model.Id"
                       class="btn btn-danger">
                        Delete
                    </a>
                }
                
                <a href="javascript:history.back()" class="btn btn-secondary">Back</a>
            </div>
            <!-- End of Real Content -->

        </div>
    </div>
</div>